/**
 * jquery.jhss.wechat.js
 * @author gexiaowei <gandxiaowei@gmail.com>
 * @version 0.3.3
 * copyright 2014-2015, gandxiaowei@gmail.com. all rights reserved.
 */

!function(a){function b(b){if(b=b||{},!b.url||!b.callback)throw new Error("参数不合法");var d=("jsonp_"+Math.random()).replace(".",""),e=document.getElementsByTagName("head")[0];b.data[b.callback]=d;var f=c(b.data),g=document.createElement("script");e.appendChild(g),console.log(d),a[d]=function(c){e.removeChild(g),clearTimeout(g.timer),a[d]=null,b.success&&b.success(c)},g.src=b.url+"?"+f,b.time&&(g.timer=setTimeout(function(){a[d]=null,e.removeChild(g),b.fail&&b.fail({message:"超时"})},time))}function c(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}a.capvision||(a.capvision={}),a.capvision.jsonp=b}(window),function(a){function b(){this.authURL="http://wx.capvision.cn/",this.appId="wx39670c44d62fb9d3",this.apiList=["onMenuShareTimeline","onMenuShareAppMessage"]}b.prototype.done=function(b){var c=this;a.capvision.jsonp({url:c.authURL,data:{url:a.location.href.replace(a.location.hash,"")},callback:"callback",success:function(a){b&&b({appId:a.appId||c.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:c.apiList})}})},a.capvision.wechatAuth=new b}(window),function(a,b){function c(){this.debug=!1,this["default"]={share:{title:b.title,link:a.location.href,imgUrl:b.getElementsByName("shareLogo").length?b.getElementsByName("shareLogo")[0].content:"http://img.itc.cn/photo/jbkRk8qUehb",desc:b.getElementsByName("description").length?b.getElementsByName("description")[0].content:""}},this.shareMessage=this["default"].share}c.prototype.register=function(){if("undefined"!=typeof wx&&a.capvision.wechatAuth){this.debug&&console.log("开始加载数据");var b=this;a.capvision.wechatAuth.done(function(a){this.debug&&console.log("开始配置微信权限",a),wx.config(a)}),wx.ready(function(){b.ready=!0,b._setAppMessage(),b._setTimeline()})}return this},c.prototype.isIn=function(){return navigator.userAgent.toLowerCase().indexOf("micromessenger")>=0},c.prototype._setAppMessage=function(){if(this.isIn()){var a=this.shareMessage||{};wx.onMenuShareAppMessage({title:a.appTitle||a.title,link:a.appLink||a.link,imgUrl:a.appImgUrl||a.imgUrl,desc:a.desc})}return this},c.prototype._setTimeline=function(){if(this.isIn()){var a=this.shareMessage||{};wx.onMenuShareTimeline({title:a.timelineTitle||a.title,link:a.timelineLink||a.link,imgUrl:a.timelineImgUrl||a.imgUrl})}return this},c.prototype.setShareMessage=function(a){for(var b in a)a[b]&&(this.shareMessage[b]=a[b]);return this.ready&&(this.debug&&console.log("设置分享内容",this.shareMessage),this._setAppMessage()._setTimeline()),this};for(var d="//res.wx.qq.com/open/js/jweixin-1.0.0.js",e=b.getElementsByTagName("script"),f=!1,g=0;g<e.length;g++){var h=e[g],i=h.getAttribute("src");if(i&&i.indexOf(d)>=0){f=!0;break}}if(a.capvision.wechat=new c,a.capvision.wechat.isIn()&&!f){var j=b.getElementsByTagName("head")[0];h=b.createElement("script"),h.onload=function(){a.capvision.wechat.register()},h.type="text/javascript",h.src=d,j.appendChild(h)}else a.capvision.wechat.register()}(window,document),function(a,b){"use strict";var c=a.module("$wechat",[]);c.provider("$wechat",function(){this.$get=[function(){return b.capvision.wechat}]})}(angular,window);
//# sourceMappingURL=angular-wechat.min.js.map