/**
 * jquery.jhss.wechat.js
 * @author gexiaowei <gandxiaowei@gmail.com>
 * @version 0.3.3
 * copyright 2014-2015, gandxiaowei@gmail.com. all rights reserved.
 */

function Auth(){this.authURL="http://asteroid.youguu.com/asteroid/wx/signature",this.appId="wx5380d5f91ec523cc",this.apiList=["onMenuShareTimeline","onMenuShareAppMessage"]}function Wechat(){this["default"]={share:{title:document.title,link:window.location.href,imgUrl:document.getElementsByName("shareLogo").length?document.getElementsByName("shareLogo")[0].content:"http://img.itc.cn/photo/jbkRk8qUehb",desc:document.getElementsByName("description").length?document.getElementsByName("description")[0].content:""}},this.shareMessage=this["default"].share}Auth.prototype.done=function(a){var b=this,c=new XMLHttpRequest;c.open("get",this.authURL+"?url="+encodeURIComponent(window.location.href.replace(window.location.hash,"")),!0),c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var d=JSON.parse(c.responseText);d&&"0000"==d.status&&a&&a({appId:d.appid||b.appId,timestamp:d.timestamp,nonceStr:d.noncestr,signature:d.signature,jsApiList:b.apiList})}},c.send()},function(a,b){for(var c="//res.wx.qq.com/open/js/jweixin-1.0.0.js",d=b.getElementsByTagName("script"),e=!1,f=0;f<d.length;f++){var g=d[f],h=g.getAttribute("src");if(h&&h.indexOf(c)>=0){e=!0;break}}if(a.wechat=new Wechat,e)a.wechat.register();else{var i=b.getElementsByTagName("head")[0];g=b.createElement("script"),g.onload=function(){a.wechat.register()},g.type="text/javascript",g.src=c,i.appendChild(g)}}(window,document),Wechat.prototype.register=function(){var a=new Auth,b=this;a.done(function(a){wx.config(a)}),wx.ready(function(){b.ready=!0,b._setAppMessage(),b._setTimeline()})},Wechat.prototype._setAppMessage=function(){var a=this.shareMessage||{};return wx.onMenuShareAppMessage({title:a.appTitle||a.title,link:a.appLink||a.link,imgUrl:a.appImgUrl||a.imgUrl,desc:a.desc}),this},Wechat.prototype._setTimeline=function(){var a=this.shareMessage||{};return wx.onMenuShareTimeline({title:a.timelineTitle||a.title,link:a.timelineLink||a.link,imgUrl:a.timelineImgUrl||a.imgUrl}),this},Wechat.prototype.setShareMessage=function(a){for(var b in a)a[b]&&(this.shareMessage[b]=a[b]);this.ready&&(this._setAppMessage(),this._setTimeline())},function(a){function b(){this.ready=!1,this.events={}}b.prototype.register=function(a){this.shareMessage=a.shareMessage,this.addPermissions(),this.setShareMessage()},b.prototype.addPermissions=function(){a.jhssJSBridge&&a.jhssJSBridge.addPermissions(this._getMetaContent("jhss-permission"))},b.prototype.setShareMessage=function(b,c){if(a.jhssJSBridge&&this._getPermissions().indexOf("share")>=0){var d=["WechatMoments","Wechat","QZone","QQ","SinaWeibo"],e=["title","description","shareLogo","link"];b=b||this.shareMessage;var f={};d.map(function(a){var d=this._getDefaultShareMessage(a);c&&c!==a||e.map(function(c){b&&(b[a+"-"+c]||b[c])&&(d[c]=b[a+"-"+c]||b[c])}),f[a]=d}.bind(this)),a.jhssJSBridge.setShareMessage(JSON.stringify(f))}},b.prototype.addMenus=function(b){var c={};return a.jhssJSBridge&&b&&(b.map(function(a){var b=(65536*(1+Math.random())|0).toString(16).substring(1);a.eventId=b,console.log(a),console.log(a.success),this.events[b]=a.success,c[b]=a}.bind(this)),a.jhssJSBridge.addMenuItems(JSON.stringify(b))),c},b.prototype.removeMenu=function(a){delete this.events[a]},b.prototype.invokeMenuEvent=function(a,b){var c=this.events[a];c&&c(b)},b.prototype._getPermissions=function(){return this._getMetaContent("jhss-permission").split(",")},b.prototype._getDefaultShareMessage=function(a){return{title:this._getMetaContent(a+"-title")||document.title||location.href,description:this._getMetaContent(a+"-description")||this._getMetaContent("description")||location.href,shareLogo:this._getMetaContent(a+"-shareLogo")||this._getMetaContent("shareLogo")||"",link:this._getMetaContent(a+"-link")||this._getMetaContent("link")||location.href}},b.prototype._getMetaContent=function(a){var b=document.getElementsByName(a)[0];return b?b.getAttribute("content")||"":""},a.appJSBridge=new b}(window),function(a,b){"use strict";var c=a.module("$wechat",[]);c.provider("$wechat",function(){this.$get=[function(){return b.wechat}]})}(angular,window);
//# sourceMappingURL=angular-wechat.min.js.map