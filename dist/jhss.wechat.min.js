/**
 * jquery.jhss.wechat.js
 * @author gexiaowei <gandxiaowei@gmail.com>
 * @version 0.2.2
 * copyright 2014-2015, gandxiaowei@gmail.com. all rights reserved.
 */

function Auth(){this.authURL="http://asteroid.youguu.com/asteroid/wx/signature",this.appId="wx7f5b58f40c143dcc",this.apiList=["onMenuShareTimeline","onMenuShareAppMessage"]}function extend(a,b){b=b||{};for(var c in b)b[c]&&(a[c]=b[c]);return a}function Wechat(){this["default"]={share:{title:document.title,link:window.location.href,imgUrl:document.getElementsByName("shareLogo").length?document.getElementsByName("shareLogo")[0].content:"http://img.itc.cn/photo/jbkRk8qUehb",desc:document.getElementsByName("description").length?document.getElementsByName("description")[0].content:""}}}Auth.prototype.done=function(a){var b=this,c=new XMLHttpRequest;c.open("get",this.authURL+"?url="+encodeURIComponent(window.location.href.replace(window.location.hash,"")),!0),c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var d=JSON.parse(c.responseText);d&&"0000"==d.status&&a&&a({appId:b.appId,timestamp:d.timestamp,nonceStr:d.noncestr,signature:d.signature,jsApiList:b.apiList})}},c.send()},function(a,b){for(var c="//res.wx.qq.com/open/js/jweixin-1.0.0.js",d=b.getElementsByTagName("script"),e=!1,f=0;f<d.length;f++){var g=d[f],h=g.getAttribute("src");if(h&&h.indexOf(c)>=0){e=!0;break}}if(a.wechat=new Wechat,e)a.wechat.register();else{var i=b.getElementsByTagName("head")[0];g=b.createElement("script"),g.onload=function(){a.wechat.register()},g.type="text/javascript",g.src=c,i.appendChild(g)}}(window,document),Wechat.prototype.register=function(){var a=new Auth,b=this;a.done(function(a){wx.config(a)}),wx.ready(function(){b.ready=!0,b._setAppMessage(),b._setTimeline()})},Wechat.prototype._setAppMessage=function(a){return a=a||{},a=extend(a,this["default"].share),wx.onMenuShareAppMessage({title:a.appTitle||a.title,link:a.appLink||a.link,imgUrl:a.appImgUrl||a.imgUrl,desc:a.desc}),this},Wechat.prototype._setTimeline=function(a){return a=a||{},a=extend(a,this["default"].share),wx.onMenuShareTimeline({title:a.timelineTitle||a.title,link:a.timelineLink||a.link,imgUrl:a.timelineImgUrl||a.imgUrl}),this},Wechat.prototype.setShareMessage=function(a){this.ready?(this._setAppMessage({title:a.appTitle||a.title,link:a.appLink||a.link,imgUrl:a.appImgUrl||a.imgUrl,desc:a.desc}),this._setTimeline({title:a.timelineTitle||a.title,link:a.timelineLink||a.link,imgUrl:a.timelineImgUrl||a.imgUrl})):this["default"].share=extend(this["default"].share,a)},function(a){function b(){a.onload=function(){console.log("设置app信息"),this.addPermissions(),this.setShareMessage(),this.invoke("ready")}.bind(this)}b.prototype.addPermissions=function(){a.jhssJSBridge&&a.jhssJSBridge.addPermissions(this._getMetaContent("jhss-permission"))},b.prototype.setShareMessage=function(b,c){if(a.jhssJSBridge&&this._getPermissions().indexOf("share")>=0){var d=["WechatMoments","Wechat","QZone","QQ","SinaWeibo"],e=["title","description","shareLogo","link"],f={};d.map(function(a){var d=this._getDefaultShareMessage(a);c&&c!==a||e.map(function(c){b&&(b[a+"-"+c]||b[c])&&(d[c]=b[a+"-"+c]||b[c])}),f[a]=d}.bind(this)),console.log(f),a.jhssJSBridge.setShareMessage(JSON.stringify(f))}},b.prototype.invoke=function(a){this.events[a]&&this.events[a].map(function(a){a()})},b.prototype.on=function(a,b){this.events[a]||(this.events[a]=[]),this.events[a].add(b)},b.prototype._getPermissions=function(){return this._getMetaContent("jhss-permission").split(",")},b.prototype._getDefaultShareMessage=function(a){return{title:this._getMetaContent(a+"-title")||document.title||location.href,description:this._getMetaContent(a+"-description")||this._getMetaContent("description")||location.href,shareLogo:this._getMetaContent(a+"-shareLogo")||this._getMetaContent("shareLogo")||"",link:this._getMetaContent(a+"-link")||this._getMetaContent("link")||location.href}},b.prototype._getMetaContent=function(a){var b=document.getElementsByName(a)[0];return b?b.getAttribute("content")||"":""},a.appJSBridge=new b}(window);
//# sourceMappingURL=jhss.wechat.min.js.map